<!DOCTYPE html>
<html>
<head>
  <title>Teacher Tools Dashboard</title>

  <!-- jQuery + jQuery UI for draggable/resizable widgets -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

  <style>
    body {
      margin: 0;
      background: #f0f0f0;
      font-family: Arial, sans-serif;
      overflow-x: hidden;
    }

    /* Toolbar Styling */
    #toolbar {
      width: 100%;
      background: #222;
      color: white;
      padding: 10px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .tool-btn {
      background: #444;
      color: white;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      border: 1px solid #333;
      transition: 0.2s;
      user-select: none;
    }

    .tool-btn:hover {
      background: #666;
    }

    /* Widget Window */
    .widget {
      position: absolute;
      padding: 10px;
      background: white;
      border: 2px solid #444;
      border-radius: 5px;
      width: 250px;
      z-index: 50;
    }

    .widget-header {
      background: #444;
      color: white;
      padding: 5px;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 3px 3px 0 0;
    }

    .widget-close {
      cursor: pointer;
      color: #ff6666;
      font-weight: bold;
    }

    textarea.sticky {
      width: 90%;
      height: 120px;
      border: none;
      outline: none;
      resize: none;
      background: transparent;
      font-size: 16px;
      padding: 5px;
    }
  </style>
</head>
<body>

<!-- Toolbar -->
<div id="toolbar">
  <div class="tool-btn" onclick="spawnStickyPicker()">Sticky Notes</div>
  <div class="tool-btn" onclick="spawnStopwatch()">Stopwatch</div>
  <div class="tool-btn" onclick="spawnCountdown()">Countdown</div>
  <div class="tool-btn" onclick="spawnTimeUntil()">Time Until</div>
  <div class="tool-btn" onclick="spawnDice()">Dice Roller</div>
  <div class="tool-btn" onclick="spawnStudentPicker()">Student Picker</div>

  <div class="tool-btn" onclick="window.open('https://script.google.com/macros/s/AKfycbzBXmIoTIx9gOI2OSRTln14EBfCN098SJjVf2dV4uiCMGGVyNQ1ZMlsuzrg2VxGMgM-/exec?page=Dashboard','_blank')">
    Open Dashboard
  </div>
</div>

<script>
/* ------------------------------
   Utility to create widget base
--------------------------------*/
function createWidget(title) {
  let box = $(`
    <div class="widget">
      <div class="widget-header">
        <span>${title}</span>
        <span class="widget-close">âœ–</span>
      </div>
      <div class="widget-body"></div>
    </div>
  `);

  $("body").append(box);

  box.draggable({ handle: ".widget-header" }).resizable();
  box.find(".widget-close").click(() => box.remove());

  // Random spawn position
  box.css({ top: Math.random()*200 + 80, left: Math.random()*200 + 80 });

  return box.find(".widget-body");
}

/* ------------------------------
   Sticky Notes
--------------------------------*/
function spawnStickyPicker() {
  let picker = createWidget("Choose Sticky Note Color");

  picker.html(`
    <button onclick="spawnSticky('yellow')">Yellow</button>
    <button onclick="spawnSticky('pink')">Pink</button>
    <button onclick="spawnSticky('blue')">Blue</button>
    <button onclick="spawnSticky('green')">Green</button>
  `);
}

function spawnSticky(color) {
  let body = createWidget("Sticky Note");
  body.parent().css({
    background: color,
    width: "220px",
    height: "200px"
  });
  body.html(`<textarea class="sticky"></textarea>`);
}

/* ------------------------------
   Stopwatch
--------------------------------*/
function spawnStopwatch() {
  let body = createWidget("Stopwatch");
  body.html(`
    <div id="swTime">00:00:00</div>
    <button onclick="startSW(this)">Start</button>
    <button onclick="pauseSW()">Pause</button>
    <button onclick="resetSW()">Reset</button>
  `);
}

let swInterval, swTime = 0;

function startSW(btn){
  if(swInterval) return;
  swInterval = setInterval(() => {
    swTime++;
    document.querySelector("#swTime").innerText =
      new Date(swTime * 1000).toISOString().substr(11, 8);
  }, 1000);
}

function pauseSW(){ clearInterval(swInterval); swInterval = null; }
function resetSW(){
  swTime = 0;
  document.querySelector("#swTime").innerText = "00:00:00";
}

/* ------------------------------
   Countdown
--------------------------------*/
function spawnCountdown(){
  let body = createWidget("Countdown Timer");
  body.html(`
    <input id="cdInput" placeholder="2025-01-01 12:00" style="width:95%"><br><br>
    <div id="cdOutput"></div>
    <button onclick="startCountdown()">Start</button>
  `);
}

function startCountdown(){
  let end = new Date(document.querySelector("#cdInput").value);
  setInterval(()=>{
    let diff = end - new Date();
    if(diff < 0){ document.querySelector("#cdOutput").innerText = "Done"; return; }
    let s = Math.floor(diff/1000);
    document.querySelector("#cdOutput").innerText =
      `${Math.floor(s/3600)}h ${(Math.floor(s/60)%60)}m ${s%60}s`;
  },1000);
}

/* ------------------------------
   Time Until Widget
--------------------------------*/
function spawnTimeUntil(){
  let body = createWidget("Time Until");
  body.html(`
    <input id="tuInput" placeholder="2:15 PM" style="width:95%"><br><br>
    <div id="tuOutput"></div>
    <button onclick="startTimeUntil()">Start</button>
  `);
}

function startTimeUntil() {
  let input = document.querySelector("#tuInput").value;
  let target = new Date();
  let parsed = new Date(target.toDateString() + " " + input);

  if (parsed < new Date()) parsed.setDate(parsed.getDate() + 1);

  setInterval(() => {
    let diff = parsed - new Date();
    let s = Math.floor(diff / 1000);
    document.querySelector("#tuOutput").innerText =
      `${Math.floor(s/3600)}h ${(Math.floor(s/60)%60)}m ${s%60}s`;
  }, 1000);
}

/* ------------------------------
   Dice Roller
--------------------------------*/
function spawnDice(){
  let body = createWidget("Dice Roller");
  body.html(`
    <div id="diceOut" style="font-size:40px">ðŸŽ²</div>
    <button onclick="rollDice()">Roll</button>
  `);
}
function rollDice(){
  document.querySelector("#diceOut").innerText = Math.floor(Math.random()*6)+1;
}

/* ------------------------------
   Student Picker
--------------------------------*/
function spawnStudentPicker(){
  let body = createWidget("Random Student Picker");
  body.html(`
    <select id="classSelect"></select><br><br>
    <button onclick="loadClasses()">Load CSVs</button><br><br>
    <button onclick="pickStudent()">Pick Student</button><br><br>
    <div id="studentOut"></div>
  `);
}

async function loadClasses(){
  let files = ["period1.csv","period2.csv","period3.csv"];
  let select = document.querySelector("#classSelect");

  select.innerHTML = "";

  for(let file of files){
    try{
      let r = await fetch(file);
      if(r.ok){
        let opt = document.createElement("option");
        opt.value = file;
        opt.text = file.replace(".csv","");
        select.appendChild(opt);
      }
    } catch{}
  }
}

async function pickStudent(){
  let file = document.querySelector("#classSelect").value;
  let out = document.querySelector("#studentOut");

  if(!file){ out.innerHTML = "Load CSV files first"; return; }

  let r = await fetch(file);
  let txt = await r.text();
  let names = txt.split("\n").map(s=>s.trim()).filter(s=>s);

  out.innerHTML = names[Math.floor(Math.random()*names.length)];
}
</script>

</body>
</html>
